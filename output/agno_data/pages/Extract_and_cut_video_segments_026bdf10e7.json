{
  "title": "Extract and cut video segments",
  "content": "def extract_segments(response_text):\n    import re\n\nsegments_pattern = r\"\\|\\s*(\\d+:\\d+)\\s*\\|\\s*(\\d+:\\d+)\\s*\\|\\s*(.*?)\\s*\\|\\s*(\\d+)\\s*\\|\"\n    segments: list[dict] = []\n\nfor match in re.finditer(segments_pattern, str(response_text)):\n        start_time = match.group(1)\n        end_time = match.group(2)\n        description = match.group(3)\n        score = int(match.group(4))\n\nstart_seconds = sum(x * int(t) for x, t in zip([60, 1], start_time.split(\":\")))\n        end_seconds = sum(x * int(t) for x, t in zip([60, 1], end_time.split(\":\")))\n        duration = end_seconds - start_seconds\n\nif 15 <= duration <= 60 and score > 7:\n            output_path = output_dir / f\"short_{len(segments) + 1}.mp4\"\n\ncommand = [\n                \"ffmpeg\",\n                \"-ss\",\n                str(start_seconds),\n                \"-i\",\n                video_path,\n                \"-t\",\n                str(duration),\n                \"-vf\",\n                \"scale=1080:1920,setsar=1:1\",\n                \"-c:v\",\n                \"libx264\",\n                \"-c:a\",\n                \"aac\",\n                \"-y\",\n                str(output_path),\n            ]\n\ntry:\n                subprocess.run(command, check=True)\n                segments.append(\n                    {\"path\": output_path, \"description\": description, \"score\": score}\n                )\n            except subprocess.CalledProcessError:\n                print(f\"Failed to process segment: {start_time} - {end_time}\")\n\nlogger.debug(f\"{response.content}\")",
  "code_samples": [],
  "headings": [],
  "url": "llms-txt#extract-and-cut-video-segments",
  "links": []
}