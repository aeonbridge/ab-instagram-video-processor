{
  "title": "Background Hooks",
  "content": "Source: https://docs.agno.com/agent-os/background-tasks/overview\n\nRun agent hooks as non-blocking background tasks in AgentOS\n\nWhen serving agents or teams through AgentOS, you can configure pre-hooks and post-hooks to run as background tasks. This means the API response is returned immediately to the user while the hooks continue executing in the background.\n\n## Why Use Background Hooks?\n\nBy default, hooks used by agents and teams in your AgentOS are in the execution path and block the response:\n\n<img className=\"block dark:hidden\" src=\"https://mintcdn.com/agno-v2/I_OqdwByK40CFkbk/images/background-tasks-notenabled-light.png?fit=max&auto=format&n=I_OqdwByK40CFkbk&q=85&s=615b75c6fd7b2bc946dd12cb853f41b6\" alt=\"Background tasks not enabled\" data-og-width=\"2895\" width=\"2895\" data-og-height=\"906\" height=\"906\" data-path=\"images/background-tasks-notenabled-light.png\" data-optimize=\"true\" data-opv=\"3\" srcset=\"https://mintcdn.com/agno-v2/I_OqdwByK40CFkbk/images/background-tasks-notenabled-light.png?w=280&fit=max&auto=format&n=I_OqdwByK40CFkbk&q=85&s=c3dcec05473d3750f9c6f9a8a2766239 280w, https://mintcdn.com/agno-v2/I_OqdwByK40CFkbk/images/background-tasks-notenabled-light.png?w=560&fit=max&auto=format&n=I_OqdwByK40CFkbk&q=85&s=942c15c932e0d71652f874088a2fcbea 560w, https://mintcdn.com/agno-v2/I_OqdwByK40CFkbk/images/background-tasks-notenabled-light.png?w=840&fit=max&auto=format&n=I_OqdwByK40CFkbk&q=85&s=84d728448bc3646060cb3af299d6117d 840w, https://mintcdn.com/agno-v2/I_OqdwByK40CFkbk/images/background-tasks-notenabled-light.png?w=1100&fit=max&auto=format&n=I_OqdwByK40CFkbk&q=85&s=e9816cdb46d2394bd0e453840a7c61be 1100w, https://mintcdn.com/agno-v2/I_OqdwByK40CFkbk/images/background-tasks-notenabled-light.png?w=1650&fit=max&auto=format&n=I_OqdwByK40CFkbk&q=85&s=d6ff0b683d01424eca2cc5112985f458 1650w, https://mintcdn.com/agno-v2/I_OqdwByK40CFkbk/images/background-tasks-notenabled-light.png?w=2500&fit=max&auto=format&n=I_OqdwByK40CFkbk&q=85&s=76d678d154f114a7cf27a93a093220f9 2500w\" />\n\n<img className=\"hidden dark:block\" src=\"https://mintcdn.com/agno-v2/I_OqdwByK40CFkbk/images/background-tasks-notenabled-dark.png?fit=max&auto=format&n=I_OqdwByK40CFkbk&q=85&s=510be4326e46562ee9d0e527a76feb33\" alt=\"Background tasks not enabled\" data-og-width=\"2895\" width=\"2895\" data-og-height=\"906\" height=\"906\" data-path=\"images/background-tasks-notenabled-dark.png\" data-optimize=\"true\" data-opv=\"3\" srcset=\"https://mintcdn.com/agno-v2/I_OqdwByK40CFkbk/images/background-tasks-notenabled-dark.png?w=280&fit=max&auto=format&n=I_OqdwByK40CFkbk&q=85&s=49cf4e5f2c43a56342ef13e3781317b5 280w, https://mintcdn.com/agno-v2/I_OqdwByK40CFkbk/images/background-tasks-notenabled-dark.png?w=560&fit=max&auto=format&n=I_OqdwByK40CFkbk&q=85&s=1b511f27bef977b7caebef20f7df5eff 560w, https://mintcdn.com/agno-v2/I_OqdwByK40CFkbk/images/background-tasks-notenabled-dark.png?w=840&fit=max&auto=format&n=I_OqdwByK40CFkbk&q=85&s=1cc96f5f92036c66a7fb3dadf51f3af9 840w, https://mintcdn.com/agno-v2/I_OqdwByK40CFkbk/images/background-tasks-notenabled-dark.png?w=1100&fit=max&auto=format&n=I_OqdwByK40CFkbk&q=85&s=94e25e9536ca3685ea2b4a1dec0f9660 1100w, https://mintcdn.com/agno-v2/I_OqdwByK40CFkbk/images/background-tasks-notenabled-dark.png?w=1650&fit=max&auto=format&n=I_OqdwByK40CFkbk&q=85&s=de03d910764ae08d2102b26ad6bfcbb0 1650w, https://mintcdn.com/agno-v2/I_OqdwByK40CFkbk/images/background-tasks-notenabled-dark.png?w=2500&fit=max&auto=format&n=I_OqdwByK40CFkbk&q=85&s=8fddb0de142ac887091432456fb46e55 2500w\" />\n\nWith background hooks enabled, your hooks won't block the response, increasing response speed:\n\n<img className=\"block dark:hidden\" src=\"https://mintcdn.com/agno-v2/I_OqdwByK40CFkbk/images/background-tasks-enabled-light.png?fit=max&auto=format&n=I_OqdwByK40CFkbk&q=85&s=b274e516d035f89d422e312945a29aaa\" alt=\"Background tasks enabled\" data-og-width=\"2271\" width=\"2271\" data-og-height=\"906\" height=\"906\" data-path=\"images/background-tasks-enabled-light.png\" data-optimize=\"true\" data-opv=\"3\" srcset=\"https://mintcdn.com/agno-v2/I_OqdwByK40CFkbk/images/background-tasks-enabled-light.png?w=280&fit=max&auto=format&n=I_OqdwByK40CFkbk&q=85&s=0f9a9b3b3aeb4e353b7f3bf992e89da7 280w, https://mintcdn.com/agno-v2/I_OqdwByK40CFkbk/images/background-tasks-enabled-light.png?w=560&fit=max&auto=format&n=I_OqdwByK40CFkbk&q=85&s=38c9e23810aaf50738deae73d851c4fb 560w, https://mintcdn.com/agno-v2/I_OqdwByK40CFkbk/images/background-tasks-enabled-light.png?w=840&fit=max&auto=format&n=I_OqdwByK40CFkbk&q=85&s=cf7a55219acaedd0560d2db624f5e81f 840w, https://mintcdn.com/agno-v2/I_OqdwByK40CFkbk/images/background-tasks-enabled-light.png?w=1100&fit=max&auto=format&n=I_OqdwByK40CFkbk&q=85&s=7cd4428ab9c6ed95bee09fc7cd132219 1100w, https://mintcdn.com/agno-v2/I_OqdwByK40CFkbk/images/background-tasks-enabled-light.png?w=1650&fit=max&auto=format&n=I_OqdwByK40CFkbk&q=85&s=297ff38f65490b1ab71844f7019b9efd 1650w, https://mintcdn.com/agno-v2/I_OqdwByK40CFkbk/images/background-tasks-enabled-light.png?w=2500&fit=max&auto=format&n=I_OqdwByK40CFkbk&q=85&s=62a4622b6eaa8134427799ce9af58c4d 2500w\" />\n\n<img className=\"hidden dark:block\" src=\"https://mintcdn.com/agno-v2/I_OqdwByK40CFkbk/images/background-tasks-enabled-dark.png?fit=max&auto=format&n=I_OqdwByK40CFkbk&q=85&s=dddbd20dd6bccab04949979587e67042\" alt=\"Background tasks enabled\" data-og-width=\"2271\" width=\"2271\" data-og-height=\"906\" height=\"906\" data-path=\"images/background-tasks-enabled-dark.png\" data-optimize=\"true\" data-opv=\"3\" srcset=\"https://mintcdn.com/agno-v2/I_OqdwByK40CFkbk/images/background-tasks-enabled-dark.png?w=280&fit=max&auto=format&n=I_OqdwByK40CFkbk&q=85&s=dcfb71d67b3b3dabc6d94d9952b56b95 280w, https://mintcdn.com/agno-v2/I_OqdwByK40CFkbk/images/background-tasks-enabled-dark.png?w=560&fit=max&auto=format&n=I_OqdwByK40CFkbk&q=85&s=98cb92e42b038280f3207a9517c9f2b5 560w, https://mintcdn.com/agno-v2/I_OqdwByK40CFkbk/images/background-tasks-enabled-dark.png?w=840&fit=max&auto=format&n=I_OqdwByK40CFkbk&q=85&s=fa3436b0d198f8c36c055ab86320a127 840w, https://mintcdn.com/agno-v2/I_OqdwByK40CFkbk/images/background-tasks-enabled-dark.png?w=1100&fit=max&auto=format&n=I_OqdwByK40CFkbk&q=85&s=9da5f237c3adcd2ddfc2df78d628f112 1100w, https://mintcdn.com/agno-v2/I_OqdwByK40CFkbk/images/background-tasks-enabled-dark.png?w=1650&fit=max&auto=format&n=I_OqdwByK40CFkbk&q=85&s=5bf6395194962d35f0137167e7c3a5bc 1650w, https://mintcdn.com/agno-v2/I_OqdwByK40CFkbk/images/background-tasks-enabled-dark.png?w=2500&fit=max&auto=format&n=I_OqdwByK40CFkbk&q=85&s=b2b2258684ff3ac029fd00825294bacf 2500w\" />\n\n* **Agent Evaluation**: Evaluate the agent's responses without affecting the responses themselves\n* **Analytics and logging**: Track usage patterns without affecting response time\n* **Notifications**: Send emails, Slack messages, or webhook calls\n* **External API calls**: Sync data with third-party services\n* **Non-critical data processing**: Tasks that don't affect the response\n\n## Enabling Background Tasks\n\nThere are two ways to enable background execution for hooks:\n\n### Option 1: Global Setting via AgentOS\n\nEnable background execution for **all** hooks across all agents and teams (even as part of a workflow):\n\nWhen enabled, this setting automatically propagates to:\n\n* All agents registered with AgentOS\n* All teams and their member agents (including nested teams)\n* All workflows and the agents/teams within their steps\n\nSee [Global Background Hooks Example](/agent-os/usage/background-hooks-global) for an example.\n\n<Note>\n  Note that pre-hooks are typically used for validation or modification of the input of a run. If you use them as background tasks, they will execute after the run has already been initiated.\n\nIf you have hooks that should not run as background tasks, you should use the second option and mark only the specific hooks to run in background.\n</Note>\n\n### Option 2: Per-Hook Setting via Decorator\n\nMark specific hooks to run in background using the `@hook` decorator:\n\nThis approach gives you fine-grained control: critical hooks are executed during the run while non-critical hooks run in the background.\n\nSee [Per-Hook Background Example](/agent-os/usage/background-hooks-decorator) for an example.\n\n<Check>\n  **Background tasks require AgentOS.** When running agents directly (not through AgentOS), the `@hook(run_in_background=True)` decorator has no effect - hooks will run synchronously.\n</Check>\n\nAgentOS uses FastAPI's [BackgroundTasks](https://fastapi.tiangolo.com/tutorial/background-tasks/) to schedule hooks for execution after the response is sent.\n\nBackground tasks execute **sequentially** after the response is sent. If you have multiple background hooks, they run one after another.\n\n<Warning>\n  **Pre- and post-hooks in background mode cannot modify the request or response.** Any modifications to `run_input` or `run_output` won't affect the agent's processing. Only use background mode for pre- and post-hooks that perform logging or monitoring. This means background mode is not suitable for Guardrails.\n</Warning>\n\nWhen hooks run in the background, AgentOS automatically creates deep copies of:\n\n* `run_input` - The input to the agent run\n* `run_context` - The current run context\n* `run_output` - The output from the agent\n\nThis prevents race conditions where background hooks might accidentally modify data that's being used elsewhere.\n\nErrors in background tasks don't affect the API response (since it's already been sent). Make sure to implement proper error handling and logging in your background hooks:\n\n## Developer Resources\n\n* View [Global Background Hooks Example](/agent-os/usage/background-hooks-global)\n* View [Per-Hook Background Example](/agent-os/usage/background-hooks-decorator)\n* View [@hook Decorator Reference](/reference/hooks/hook-decorator)\n* View [Hooks Overview](/basics/hooks/overview)\n* View [Cookbook Examples](https://github.com/agno-agi/agno/tree/main/cookbook/agent_os/background_tasks)",
  "code_samples": [
    {
      "code": "When enabled, this setting automatically propagates to:\n\n* All agents registered with AgentOS\n* All teams and their member agents (including nested teams)\n* All workflows and the agents/teams within their steps\n\nSee [Global Background Hooks Example](/agent-os/usage/background-hooks-global) for an example.\n\n<Note>\n  Note that pre-hooks are typically used for validation or modification of the input of a run. If you use them as background tasks, they will execute after the run has already been initiated.\n\n  If you have hooks that should not run as background tasks, you should use the second option and mark only the specific hooks to run in background.\n</Note>\n\n### Option 2: Per-Hook Setting via Decorator\n\nMark specific hooks to run in background using the `@hook` decorator:",
      "language": "unknown"
    },
    {
      "code": "This approach gives you fine-grained control: critical hooks are executed during the run while non-critical hooks run in the background.\n\nSee [Per-Hook Background Example](/agent-os/usage/background-hooks-decorator) for an example.\n\n<Check>\n  **Background tasks require AgentOS.** When running agents directly (not through AgentOS), the `@hook(run_in_background=True)` decorator has no effect - hooks will run synchronously.\n</Check>\n\n## How It Works\n\nAgentOS uses FastAPI's [BackgroundTasks](https://fastapi.tiangolo.com/tutorial/background-tasks/) to schedule hooks for execution after the response is sent.\n\nBackground tasks execute **sequentially** after the response is sent. If you have multiple background hooks, they run one after another.\n\n<Warning>\n  **Pre- and post-hooks in background mode cannot modify the request or response.** Any modifications to `run_input` or `run_output` won't affect the agent's processing. Only use background mode for pre- and post-hooks that perform logging or monitoring. This means background mode is not suitable for Guardrails.\n</Warning>\n\n### Data Isolation\n\nWhen hooks run in the background, AgentOS automatically creates deep copies of:\n\n* `run_input` - The input to the agent run\n* `run_context` - The current run context\n* `run_output` - The output from the agent\n\nThis prevents race conditions where background hooks might accidentally modify data that's being used elsewhere.\n\n### Error Handling\n\nErrors in background tasks don't affect the API response (since it's already been sent). Make sure to implement proper error handling and logging in your background hooks:",
      "language": "unknown"
    }
  ],
  "headings": [
    {
      "level": "h2",
      "text": "Why Use Background Hooks?",
      "id": "why-use-background-hooks?"
    },
    {
      "level": "h2",
      "text": "Enabling Background Tasks",
      "id": "enabling-background-tasks"
    },
    {
      "level": "h3",
      "text": "Option 1: Global Setting via AgentOS",
      "id": "option-1:-global-setting-via-agentos"
    },
    {
      "level": "h3",
      "text": "Option 2: Per-Hook Setting via Decorator",
      "id": "option-2:-per-hook-setting-via-decorator"
    },
    {
      "level": "h2",
      "text": "How It Works",
      "id": "how-it-works"
    },
    {
      "level": "h3",
      "text": "Data Isolation",
      "id": "data-isolation"
    },
    {
      "level": "h3",
      "text": "Error Handling",
      "id": "error-handling"
    },
    {
      "level": "h2",
      "text": "Developer Resources",
      "id": "developer-resources"
    }
  ],
  "url": "llms-txt#background-hooks",
  "links": []
}