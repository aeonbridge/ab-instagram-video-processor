{
  "title": "Custom function to prepare input for Notion agent",
  "content": "def prepare_notion_input(step_input: StepInput) -> StepOutput:\n    \"\"\"\n    Extract the classification result and format it for the Notion agent.\n    \"\"\"\n    # Get the classification result from the previous step (Classify Query)\n    previous_output = step_input.previous_step_content\n\n# Parse it into our Pydantic model if it's a dict\n    if isinstance(previous_output, dict):\n        classification = ClassificationResult(**previous_output)\n    elif isinstance(previous_output, str):\n        # If it's a string, try to parse it or use the original input\n        import json\n\ntry:\n            classification = ClassificationResult(**json.loads(previous_output))\n        except (json.JSONDecodeError, TypeError, KeyError, ValueError):\n            classification = ClassificationResult(\n                query=str(step_input.input),\n                tag=\"general-blogs\",\n                message=\"Failed to parse classification\",\n            )\n    else:\n        classification = previous_output\n\n# Create a clear instruction for the Notion agent with EXPLICIT tag requirement\n    instruction = f\"\"\"Process this classified query:\n\nQuery: {classification.query}\n        Tag: {classification.tag}\n\nIMPORTANT: You MUST use the tag \"{classification.tag}\" (one of: travel, tech, general-blogs, fashion, documents).\n        Do NOT create a new tag. Use EXACTLY \"{classification.tag}\".\n\nInstructions:\n        1. Use search_pages tool to find pages with tag \"{classification.tag}\"\n        2. If page exists: Use update_page to add the query content\n        3. If no page exists: Use create_page with title \"My {classification.tag.title()} Collection\", tag \"{classification.tag}\", and the query as content\n\nThe tag MUST be exactly: {classification.tag}\n    \"\"\"\n\nreturn StepOutput(content=instruction)",
  "code_samples": [],
  "headings": [],
  "url": "llms-txt#custom-function-to-prepare-input-for-notion-agent",
  "links": []
}